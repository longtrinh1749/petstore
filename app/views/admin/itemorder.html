<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <!--    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>-->
    <style>

        * {
            box-sizing: border-box;
        }

        /* Create two equal columns that floats next to each other */
        .column {
            text-align: center;
            float: left;
            width: 110px;
        }

        .desColumn {
            text-align: center;
            float: left;
            width: 110px;
        }

        .actionColumn {
            text-align: center;
            float: right;
            width: 8%;
        }

        .row {
            /*border-style: solid;*/
            /*border-width: thin;*/
            /*border-color: black;*/
        }

        /* Clear floats after the columns */
        .row:after {
            content: "";
            display: table;
            clear: both;
        }

        .ta {
            width: 109px;
            height: 40px
        }

        .taDes {
            width: 109px;
            height: 40px;
        }
    </style>
</head>
<body>
<a href="/admin">Return to Home</a>
<div class="row">
    <div class="column">
        ID
    </div>
    <div class="column">
        ItemId
    </div>
    <div class="column">
        Size
    </div>
    <div class="column">
        Quantity
    </div>
    <div class="column">
        Name
    </div>
    <div class="column">
        Email
    </div>
    <div class="column">
        Phoneno
    </div>
    <div class="column">
        Note
    </div>
    <div class="column">
        Date created
    </div>
    <div class="column">
        Date purchased
    </div>
    <div class="column">
        Purchase
    </div>
</div>
<form id="searchForm">
    <div class="row">
        <div class="column">
            <input class="ta" type="text" id="searchId" value="">
        </div>
        <div class="column">
            <input class="ta" type="text" id="searchItemId" value="">
        </div>
        <div class="column">
            <input class="ta" type="text" id="searchSize" value="">
        </div>
        <div class="column">
            <input class="ta" type="text" id="searchQuantity" value="">
        </div>
        <div class="column">
            <input class="ta" type="text" id="searchName" value="">
        </div>
        <div class="column">
            <input class="ta" type="text" id="searchEmail" value="">
        </div>
        <div class="column">
            <input class="ta" type="text" id="searchPhoneno" value="">
        </div>
        <div class="column">
            <input class="ta" type="text" id="searchNote" value="">
        </div>
        <div class="column">
            <input class="ta" type="text" id="searchTimestamp" value="">
        </div>
        <div class="column">
            <input class="ta" type="text" id="searchPurchaseTimestamp" value="">
        </div>
        <div class="column">
            <input class="ta" type="text" id="searchPurchase" value="">
        </div>
        <div class="actionColumn">
            <button id="searchAllButton" type="button" value="Search" onclick="getAllItemorderRequest()">Search All</button>
            <button id="searchButton" type="button" value="Search" onclick="searchItemorder()">Search</button>
            <button class="createButton" id="createButton" type="button" value="Create" onclick="createItemorder()">Create</button>
            <input type="reset">
        </div>
    </div>
</form>
<div>Your pet orders:</div>
<!--dung jquery ajax how to submit form without redirect-->
<!--https://stackoverflow.com/questions/25983603/how-to-submit-an-html-form-without-redirection-->
<div class="row" id="itemorders">

</div>
<script>

    function getXMLHttpRequest() {
        var req, err;
        try {
            req = new XMLHttpRequest();
        } catch (err) {
            try {
                req = new ActiveXObject("MSXML2.XMLHttp.6.0");
            } catch (err) {
                try {
                    req = new ActiveXObject("MSXML2.XMLHttp.3.0");
                } catch (err) {
                    req = false;
                }
            }
        }
        return req;
    }

    var ajaxRequest = getXMLHttpRequest();

    function getAllItemorderRequest() {
        if (ajaxRequest) {
            ajaxRequest.onreadystatechange = getItemorderResponse;
            ajaxRequest.open("GET", "http://localhost:3000/admin/itemorders/allwithlist");
            ajaxRequest.send(null);
        }
    }

    function searchItemorder() {
        if (ajaxRequest) {
            ajaxRequest.onreadystatechange = getItemorderResponse;
            ajaxRequest.open("POST", "http://localhost:3000/admin/itemorders/getwithlist", true);
            ajaxRequest.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            // ajaxRequest.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
            let datas = "";
            let id = document.getElementById("searchId").value;
            let itemid = document.getElementById("searchItemId").value;
            let size = document.getElementById("searchSize").value;
            let quantity = document.getElementById("searchQuantity").value;
            let name = document.getElementById("searchName").value;
            let email = document.getElementById("searchEmail").value;
            let phoneno = document.getElementById("searchPhoneno").value;
            let note = document.getElementById("searchNote").value;
            let timestamp = document.getElementById("searchTimestamp").value;
            let purchaseTimestamp = document.getElementById("searchPurchaseTimestamp").value;
            let purchase = document.getElementById("searchPurchase").value;
            datas += '&id=' + id + '&itemid=' + itemid + '&size=' + size + '&quantity=' + quantity + '&name=' + name + '&email=' + email + '&phoneno=' + phoneno
                + '&note=' + note + '&timestamp=' + timestamp + '&purchaseTimestamp=' + purchaseTimestamp + '&purchase=' + purchase;
            ajaxRequest.send(datas);
        }
    }

    function createItemorder() {
        if (ajaxRequest) {
            ajaxRequest.onreadystatechange = getItemorderCreateResponse;
            ajaxRequest.open("POST", "http://localhost:3000/admin/itemorders/create", true);
            ajaxRequest.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            let datas = "";
            let id = document.getElementById("searchId").value;
            let itemid = document.getElementById("searchItemId").value;
            let name = document.getElementById("searchName").value;
            let email = document.getElementById("searchEmail").value;
            let phoneno = document.getElementById("searchPhoneno").value;
            let note = document.getElementById("searchNote").value;
            let timestamp = document.getElementById("searchTimestamp").value;
            let purchaseTimestamp = document.getElementById("searchPurchaseTimestamp").value;
            let purchase = document.getElementById("searchPurchase").value;
            datas += 'id=' + id + '&itemid=' + itemid + '&name=' + name + '&email=' + email + '&phoneno=' + phoneno
                + '&note=' + note + + '&timestamp=' + timestamp + '&purchaseTimestamp=' + purchaseTimestamp + '&purchase=' + purchase;
            ajaxRequest.send(datas);
            // ajaxRequest.send('&id=' + id);
        }
    }

    function updateItemorder(itemorder) {
        if (ajaxRequest) {
            ajaxRequest.onreadystatechange = getItemorderUpdateResponse;
            ajaxRequest.open("POST", "http://localhost:3000/admin/itemorders/confirm", true);
            ajaxRequest.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            // ajaxRequest.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
            let datas = "";
            datas += '&id=' + itemorder.id + '&itemid=' + itemorder.itemid + '&size=' + size + '&quantity=' + quantity + '&name=' +
                itemorder.name + '&email=' + itemorder.email + '&phoneno=' + itemorder.phoneno + '&timestamp=' + itemorder.timestamp +
                '&purchaseTimestamp=' + itemorder.purchaseTimestamp + '&purchase=' + itemorder.purchase;
            ajaxRequest.send(datas);
        }
    }

    function deleteItemorder(itemorder) {
        if (ajaxRequest) {
            ajaxRequest.onreadystatechange = getItemorderDeleteResponse;
            ajaxRequest.open("POST", "http://localhost:3000/admin/itemorders/delete", true);
            ajaxRequest.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            // ajaxRequest.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
            let datas = "";
            datas += '&id=' + itemorder.id;
            ajaxRequest.send(datas);
        }
    }

    function purchaseItemorder(itemorder) {
        if (ajaxRequest) {
            ajaxRequest.onreadystatechange = getItemorderPurchaseResponse;
            ajaxRequest.open("POST", "http://localhost:3000/admin/itemorders/purchase", true);
            ajaxRequest.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            // ajaxRequest.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
            let datas = "";
            datas += '&id=' + itemorder.id + '&itemid=' +itemorder.itemid;
            ajaxRequest.send(datas);
        }
    }

    function updateButtonPress(button) {
        console.log("asdasd");
        var id = button.id.replace("updateButton", "");
        var buttonItemId = button.class;
        var buttonId = button.id;
        // console.log("onClick: button itemid: ", buttonItemId, "||id: ", id, "||button id: ", buttonId);
        // if (document.getElementById(buttonId).innerHTML === "Confirm") {
        //     document.getElementById(id).getElementsByClassName("ta")[1].removeAttribute("readonly");
        //     document.getElementById(id).getElementsByClassName("ta")[2].removeAttribute("readonly");
        //     document.getElementById(id).getElementsByClassName("ta")[3].removeAttribute("readonly");
        //     document.getElementById(id).getElementsByClassName("ta")[4].removeAttribute("readonly");
        //     document.getElementById(id).getElementsByClassName("ta")[5].removeAttribute("readonly");
        //     document.getElementById(id).getElementsByClassName("ta")[6].removeAttribute("readonly");
        //     document.getElementById(id).getElementsByClassName("ta")[7].removeAttribute("readonly");
        //     document.getElementById(buttonId).innerHTML = "Done";
        // } else {
        var itemorder = {};
        // console.log(document.getElementById(id).getElementsByClassItemId("ta")[9].value);
        itemorder.id = document.getElementById(id).getElementsByClassName("ta")[0].value;
        itemorder.itemid = document.getElementById(id).getElementsByClassName("ta")[1].value;
        // itemorder.name = document.getElementById(id).getElementsByClassName("ta")[2].value;
        // itemorder.email = document.getElementById(id).getElementsByClassName("ta")[3].value;
        // itemorder.phoneno = document.getElementById(id).getElementsByClassName("ta")[4].value;
        // itemorder.timestamp = document.getElementById(id).getElementsByClassName("ta")[5].value;
        // itemorder.purchaseTimestamp = document.getElementById(id).getElementsByClassName("ta")[6].value;
        // // itemorder.purchase = document.getElementById(id).getElementsByClassName("ta")[7].value;
        // document.getElementById(id).getElementsByClassName("ta")[1].readOnly = true;
        // document.getElementById(id).getElementsByClassName("ta")[2].readOnly = true;
        // document.getElementById(id).getElementsByClassName("ta")[3].readOnly = true;
        // document.getElementById(id).getElementsByClassName("ta")[4].readOnly = true;
        // document.getElementById(id).getElementsByClassName("ta")[5].readOnly = true;
        // document.getElementById(id).getElementsByClassName("ta")[6].readOnly = true;
        // // document.getElementById(id).getElementsByClassName("ta")[7].readOnly = true;
        // document.getElementById(buttonId).innerHTML = "Confirm";
        updateItemorder(itemorder);
        // }
    }

    function deleteButtonPress(button) {
        var id = button.id.replace("deleteButton", "");
        var buttonItemId = button.class;
        var buttonId = button.id;
        // console.log("onClick: button itemid: ", buttonItemId, "||id: ", id, "||button id: ", buttonId);
        var itemorder = {};
        itemorder.id = document.getElementById(id).getElementsByClassName("ta")[0].value;
        deleteItemorder(itemorder);
    }

    function purchaseButtonPress(button) {
        var id = button.id.replace("purchaseButton", "");
        var buttonItemId = button.class;
        var buttonId = button.id;
        // console.log("onClick: button itemid: ", buttonItemId, "||id: ", id, "||button id: ", buttonId);
        var itemorder = {};
        itemorder.id = document.getElementById(id).getElementsByClassName("ta")[0].value;
        itemorder.itemid = document.getElementById(id).getElementsByClassName("ta")[1].value;
        purchaseItemorder(itemorder);
    }

    function getItemorderResponse() {
        if (ajaxRequest.readyState != 4) return;
        else {
            if (ajaxRequest.status == 200) {
                var jsonRes = JSON.parse(ajaxRequest.responseText);
                var tmpHtml = "";
                for (var i = 0; i < jsonRes.length; i++) {
                    tmpHtml += '<div class="row" id="' + i + '">';
                    tmpHtml += '<div class="column"><textarea class="ta" id="indexId' + i + '" readonly="readonly">' + jsonRes[i].id + '</textarea></div>';
                    tmpHtml += '<div class="column"><textarea class="ta" id="indexItemId' + i + '" readonly="readonly">' + jsonRes[i].itemid + '</textarea></div>';
                    tmpHtml += '<div class="column"><textarea class="ta" id="indexItemSize' + i + '" readonly="readonly">' + jsonRes[i].size + '</textarea></div>';
                    tmpHtml += '<div class="column"><textarea class="ta" id="indexItemQuantity' + i + '" readonly="readonly">' + jsonRes[i].quantity + '</textarea></div>';
                    tmpHtml += '<div class="column"><textarea class="ta" id="indexName' + i + '" readonly="readonly">' + jsonRes[i].name + '</textarea></div>';
                    tmpHtml += '<div class="column"><textarea class="ta" id="indexEmail' + i + '" readonly="readonly">' + jsonRes[i].email + '</textarea></div>';
                    tmpHtml += '<div class="column"><textarea class="ta" id="indexPhoneno' + i + '" readonly="readonly">' + jsonRes[i].phoneno + '</textarea></div>';
                    if((i > 1 && jsonRes[i].id != jsonRes[i-1].id) || i == 0) {
                        tmpHtml += '<div class="column"><textarea class="ta" id="indexPhoneno' + i + '" readonly="readonly">' + jsonRes[i].note + '</textarea></div>';

                        tmpHtml += '<div class="column"><textarea class="ta" id="indexTimestamp' + i + '" readonly="readonly">' + jsonRes[i].timestamp + '</textarea></div>';
                        tmpHtml += '<div class="column"><textarea class="ta" id="indexPurchaseTimestamp' + i + '" readonly="readonly">' + jsonRes[i].purchaseTimestamp + '</textarea></div>';
                        tmpHtml += '<div class="column"><textarea class="ta" id="purchase' + i + '" readonly="readonly">' + jsonRes[i].purchase + '</textarea></div>';
                    }
                    if((i > 0 && jsonRes[i].id != jsonRes[i-1].id) || i == 0) {
                        tmpHtml += '<div class="actionColumn" >\n' +
                            '        <button type="button" class="updateButton" id="updateButton' + i + '" value="Confirm" onclick="updateButtonPress(this)">Confirm</button>' +
                            '        <button type="button" class="deleteButton" id="deleteButton' + i + '" value="Delete" onclick="deleteButtonPress(this)">Delete</button>' +
                            '        <button type="button" class="purchaseButton" id="purchaseButton' + i + '" value="Purchase" onclick="purchaseButtonPress(this)">Purchase</button>' +
                            '</div>';
                    }
                    tmpHtml += '</div>';
                }
                // console.log(tmpHtml);
                document.getElementById("itemorders").innerHTML = tmpHtml;
            } else {
                alert("Request failed: ", ajaxRequest.statusText);
            }
        }
        // restartJQuery();
    }

    function getItemorderCreateResponse() {
        if (ajaxRequest.readyState != 4) return;
        else {
            if (ajaxRequest.status == 200) {
                console.log("Create success");
                searchItemorder();
            } else {
                alert("Request failed: ", ajaxRequest.statusText);
            }
        }
        // restartJQuery();
    }
    function getItemorderDeleteResponse() {
        if (ajaxRequest.readyState != 4) return;
        else {
            if (ajaxRequest.status == 200) {
                console.log("Delete success");
                searchItemorder();
            } else {
                alert("Request failed: ", ajaxRequest.statusText);
            }
        }
        // restartJQuery();
    }

    function getItemorderPurchaseResponse() {
        if (ajaxRequest.readyState != 4) return;
        else {
            if (ajaxRequest.status == 200) {
                console.log("Purchase success");
                searchItemorder();
            } else {
                alert("Request failed: ", ajaxRequest.statusText);
            }
        }
        // restartJQuery();
    }

    function getItemorderUpdateResponse() {
        if (ajaxRequest.readyState != 4) return;
        else {
            if (ajaxRequest.status == 200) {
                console.log("Update success");
                searchItemorder();
            } else {
                alert("Request failed: ", ajaxRequest.statusText);
            }
        }
    }

    getAllItemorderRequest();
</script>
</body>
</html>